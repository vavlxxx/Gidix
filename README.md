# Gidix — информационная система управления экскурсионными маршрутами

Gidix — веб‑приложение для туристической компании: публичный каталог экскурсионных маршрутов, прием заявок и админ‑панель для управления контентом, бронированиями, отзывами, тарифами и правами доступа.

## Компоненты приложения

### 1) Frontend (React + Vite)
- Публичный сайт с каталогом маршрутов и страницей маршрута.
- Форма заявки на экскурсию.
- Блок отзывов (отправка + просмотр опубликованных).
- Админ‑панель: маршруты, заявки, тарифы, пользователи, права.

### 2) Backend (FastAPI)
- REST API.
- Аутентификация и роли пользователей.
- Модерация отзывов.
- Управление маршрутами, датами, заявками, тарифами.
- Система прав (rules) и связь прав с пользователями.

### 3) База данных (PostgreSQL + PostGIS)
- Хранение маршрутов, дат, точек, фото, заявок и отзывов.
- Геоданные точек маршрута (PostGIS).

---

## Основные сценарии работы

### Публичный сайт
1) Откройте каталог маршрутов.
2) Перейдите на страницу маршрута, изучите описание, точки и цены.
3) Оставьте заявку: выберите дату, заполните контактные данные.
4) Оставьте отзыв: выберите дату экскурсии, введите код брони и email.
   - Отзыв уходит на модерацию и публикуется только после подтверждения администратора.

### Админ‑панель
Вход: `/admin/login`

**Маршруты**
- Создание/редактирование маршрута (описание, точки на карте, фото, цены, тарифы).
- Публикация/снятие с публикации.

**Даты**
- Добавление дат и времени.
- Назначение экскурсовода.
- Перенос и скрытие дат.

**Заявки**
- Просмотр заявок и изменение статуса.

**Отзывы**
- Просмотр отзывов по маршруту.
- Публикация (модерация) отзывов.

**Тарифы**
- Создание коэффициентов, влияющих на цену (например, «Семейный», «Групповой»).

**Пользователи и права**
- Создание пользователей, назначение ролей.
- Управление индивидуальными правами в разделе «Права».

---

## Роли и права
- **guide** — экскурсовод (назначается на даты).
- **manager** — управление маршрутами, заявками, отзывами и тарифами.
- **admin** — управление пользователями и правилами доступа, наследует права manager.
- **superuser** — полный доступ ко всем действиям.

При смене роли пользователю автоматически назначаются права, связанные с ролью. Дополнительно можно выдавать индивидуальные права через админ‑панель.

---

## Быстрый старт (Docker)

```bash
docker compose up --build
```

После запуска:
- Frontend: http://localhost:5173
- Backend: http://localhost:8000
- Документация API: http://localhost:8000/api/docs

---

## Локальный запуск без Docker

### Backend

```bash
cd backend
python -m venv .venv
. .venv/Scripts/activate  # Windows PowerShell
pip install -r requirements.txt
uvicorn app.main:app --reload
```

### Frontend

```bash
cd frontend
npm install
npm run dev
```

---

## Переменные окружения

**Основные:**
- `DATABASE_URL` — полная строка подключения к БД
- `CFG_DB__HOST`, `CFG_DB__USER`, `CFG_DB__NAME`, `CFG_DB__PORT`, `CFG_DB__PASSWORD`
- `SECRET_KEY`
- `CORS_ORIGINS`

Если `DATABASE_URL` не задан, бэкенд собирает строку подключения из `CFG_DB__*`.

---

## Учетные записи по умолчанию

- **Администратор:** `admin@example.com` / `admin123`
- **Менеджер:** `manager@example.com` / `manager123`
- **Суперпользователь:** `superuser@example.com` / `superuser123`

---

## Структура репозитория
- `backend/` — FastAPI, модели БД, REST API
- `frontend/` — React-приложение (Vite)
- `docker-compose.yml` — запуск сервисов
